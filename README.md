# Braincrub

**This is a draft version of the README, it will be improved.**

Braincrub is a CLI to lint or run Brainfuck. This is my first project done from zero in Rust, and no LLM has been used to build this CLI. The reason **not to use** an LLM to generate code is because I want to learn the quirks of Rust and, by trial and error, get used to the ownership model and lifetimes. If I copy and paste the code generated by an LLM, I will never learn.

## Decisions

- This project requires Rust nightly, **version nightly-2025-10-15**, as it **heavily uses** the experimental AsciiChar feature. Brainfuck uses ASCII, while Rust strings are UTF-8; instead of doing the conversion manually, I'm using the experimental feature to focus more on other aspects of the language.
- The project could be done more simply — as simple as reading the file and processing the string while ensuring the brackets are balanced. No traits, no structs. At this point in my Rust journey, I'm used to that kind of program. However, I wanted to do a bit of overengineering.

## Implementation

The CLI is split into 5 files:

- `file.rs`: Responsible for handling the reading of the file passed as an argument to the CLI.
- `io.rs`: Defines and implements the Input, Output, and Memory traits for our interpreter.
- `parser.rs`: Converts our Brainfuck source code string into a simple AST representation. It checks if the brackets for the loops are balanced.
- `interpreter.rs`: Defines the interpreter struct that expects an AST, an input, an output, and a memory implementation based on our traits located in `io.rs`. This struct runs the code, though the code at this point is only syntactically correct.
- `main.rs`: The CLI implementation uses Clap.

I won't claim that 100% of the code is tested — I don't have coverage to confirm it — but most of the code has unit tests and integration tests for both the interactive and non-interactive paths of our CLI.

## Tools

For development:

- Clap: Used to build the CLI app.
- Inquire: Used to implement the Input trait. Inquire makes it easy to wait for input in our CLI app.
- thiserror: Reduces boilerplate for generating the errors that the CLI should handle.

For testing:

- assert_cmd: Used to test the CLI paths that don't expect any interaction.
- expectrl: Makes it easy to interact with commands that expect input during execution.
- predicates: Used to create more robust checks for the text displayed by our CLI.

## Learnings

- Iterator and IntoIterator traits — on top of that, the iterator struct is a wrapper around the AST data structure.
- Default trait: Reduces boilerplate during unit testing by allowing a default trait implementation.
- TryFrom trait: How to implement custom casting between types.
- Display trait: For one of my NewTypes.
- NewType pattern: I didn't know it had a name for wrapping basic types.
- Differences between [position] and `.get()` in vectors: the first one moves the value, the second one is a reference. ~~The time lost trying to understand why the `next` method was complaining about lifetimes~~.
- `unwrap` uses the Debug trait instead of the Display trait that the `thisError` crate implements. Source: https://github.com/dtolnay/thiserror/issues/210
- Testing interactive and non-interactive CLI apps.
- `CARGO_TARGET_TMPDIR` is a stable environment variable that returns the path to a folder for creating tmp files for **integration tests**.
- `CARGO_MANIFEST_DIR` is a stable environment variable that returns the path to the current project, ideal for locating your files for unit and integration tests.
- Take advantage of conditional compilation to create structs or enhance structs to make a private API for testing.
- If a type that doesn't belong to my crate doesn't implement a specific trait, wrap it in a custom type and implement it.

## Conclusion

It probably isn't the best code, but I'm proud, as this is the first project I completed without guidance or base code. I want to thank my previous projects that I left halfway. And last but not least, the people of BCNEng who helped me and answered all my questions ❤️.
